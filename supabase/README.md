# Supabase Integration for Twisdom

This directory contains the Supabase configuration and database migrations for the Twisdom application.

## Database Schema

The database schema is defined in the `migrations` directory. The migrations are applied in order, and each migration file contains SQL statements to create or modify the database schema.

- `20250304_initial_schema.sql`: Initial schema with tables for bookmarks, tags, collections, etc.

## Applying Migrations

To apply the migrations, run the following command from the project root:

```bash
./scripts/apply-migrations.sh
```

This script will:
1. Check if Supabase is running, and start it if necessary
2. Apply all migrations in order
3. Reset the database (warning: this will delete all data)

## Data Structure

The database schema includes the following tables:

- `twitter_bookmarks`: Stores bookmark data including content, metadata, and AI analysis results
- `tags`: Stores tag definitions
- `bookmark_tags`: Junction table linking bookmarks to tags
- `collections`: Stores collection definitions
- `collection_bookmarks`: Junction table linking bookmarks to collections
- `highlights`: Stores text highlights for bookmarks
- `reading_queue`: Stores reading queue status for bookmarks

## AI Analysis Data

The AI analysis data is stored in the following columns in the `twitter_bookmarks` table:

- `ai_tags`: Array of tags generated by AI
- `suggested_tags`: Array of tags suggested by AI but not yet applied
- `extracted_links`: JSON array of links extracted from the bookmark content
- `ai_analysis`: JSON object containing the full AI analysis results

## Real-time Data Persistence

The application now ensures that all data is persisted to the database in real-time:

1. AI analysis results are saved immediately after generation
2. Reading queue changes are saved immediately
3. Tag changes are saved immediately
4. Collection changes are saved immediately

This ensures that users will see their data exactly as they left it when they reload the page or access from another device.